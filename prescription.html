<!DOCTYPE html>
<html>
<head>
  <title>Prescription</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body onload="initPrescription()">

 
  <!-- Menu -->
  <div id="menu">
    <nav class="menu-bar">
  <ul>
    <li><a href="dashboard.html">ğŸ  Dashboard</a></li>
    <li><a href="patient.html">ğŸ§¾ Patients</a></li>
    <li><a href="remedy.html">ğŸ’Š Remedies</a></li>
    <li><a href="prescription.html">ğŸ“„ Prescriptions</a></li>
    <li><a href="payment.html">ğŸ’° Payments</a></li>
    <li><a href="report.html">ğŸ“Š Reports</a></li>
    <li><a href="#" onclick="logout()">ğŸšª Logout</a></li>
  </ul>
</nav>
  </div>

  
<h2>Prescription Entry</h2>


<label>Patient</label><br>

<input type="text" id="patientSearch" 
       placeholder="Search patient name or mobile..." 
       onkeyup="filterPatientList()">

<select id="patientSelect" size="5" 
        style="width:100%;"
        onchange="patientChanged()">
</select>

<br><br>
<label>Date</label><br>
<input type="date" id="pdate"><br><br>

<label>Symptoms</label><br>
<textarea id="symptoms"></textarea><br><br>

<label>Remedy</label><br>
<select id="remedySelect"></select>
<input type="text" id="power" placeholder="Power">
<button onclick="addRemedyRow()">Add Remedy</button>

<ul id="remedyList"></ul>

<label>Usage</label><br>
<textarea id="usage"></textarea><br><br>

<label>Previous Due</label><br>
<input type="number" id="previousDue" readonly><br><br>

<label>Fee</label><br>
<input type="number" id="fee" oninput="calculateTotal()"><br><br>

<label>Total</label><br>
<input type="number" id="total" readonly><br><br>

<label>Paid</label><br>
<input type="number" id="paid" oninput="calculateDue()"><br><br>

<label>Remaining Due</label><br>
<input type="number" id="due" readonly><br><br>

<label>Next Visit</label><br>
<input type="date" id="nextVisit"><br><br>

<button onclick="savePrescription()">Save Prescription</button>

<hr>

<h3>Prescription List</h3>
<table border="1" width="100%" id="prescriptionTable"></table>
<script>
function patientChanged(){

  const patientId = document.getElementById("patientSelect").value;
  if(!patientId) return;

  post({
    action:"getLastPrescription",
    patientId: patientId
  }).then(res=>{

    if(res.success && res.data){

      const symptomsEl = document.getElementById("symptoms");
      const prevDueEl = document.getElementById("previousDue");

      if(symptomsEl)
        symptomsEl.value = res.data.symptoms || "";

      if(prevDueEl)
        prevDueEl.value = res.data.previousDue || 0;

    } else {

      // If no previous prescription
      document.getElementById("symptoms").value = "";
      document.getElementById("previousDue").value = 0;
    }

  }).catch(err=>{
    console.log("Error loading last prescription:", err);
  });
}
</script>  
<script src="app.js"></script>

</body>
</html>
