<!DOCTYPE html>
<html>
<head>
  <title>Prescription</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body onload="initPrescription()">

<h2>Prescription Entry</h2>


<label>Patient</label><br>

<input type="text" id="patientSearch" 
       placeholder="Search patient name or mobile..." 
       onkeyup="filterPatientList()">

<select id="patientSelect" size="5" 
        style="width:100%;"
        onchange="selectPatient()">
</select>

<br><br>
<label>Date</label><br>
<input type="date" id="pdate"><br><br>

<label>Symptoms</label><br>
<textarea id="symptoms"></textarea><br><br>

<label>Remedy</label><br>
<select id="remedySelect"></select>
<input type="text" id="power" placeholder="Power">
<button onclick="addRemedyRow()">Add Remedy</button>

<ul id="remedyList"></ul>

<label>Usage</label><br>
<textarea id="usage"></textarea><br><br>

<label>Previous Due</label><br>
<input type="number" id="previousDue" readonly><br><br>

<label>Fee</label><br>
<input type="number" id="fee" oninput="calculateTotal()"><br><br>

<label>Total</label><br>
<input type="number" id="total" readonly><br><br>

<label>Paid</label><br>
<input type="number" id="paid" oninput="calculateDue()"><br><br>

<label>Remaining Due</label><br>
<input type="number" id="due" readonly><br><br>

<label>Next Visit</label><br>
<input type="date" id="nextVisit"><br><br>

<button onclick="savePrescription()">Save Prescription</button>

<hr>

<h3>Prescription List</h3>
<table border="1" width="100%" id="prescriptionTable"></table>
<script>
  function patientChanged(){

  const patientId = document.getElementById("patientSelect").value;

  if(!patientId) return;

  post({
    action:"getLastPrescription",
    patientId: patientId
  }).then(res=>{

    if(res.data){

      document.getElementById("symptoms").value = res.data.symptoms || "";
      document.getElementById("remedies").value = res.data.remedies || "";
      document.getElementById("usage").value = res.data.usage || "";
      document.getElementById("previousDue").value = res.data.previousDue || 0;

      calculateTotal(); // if you have auto calculation
    }
    else{
      // clear if no previous record
      document.getElementById("symptoms").value = "";
      document.getElementById("remedies").value = "";
      document.getElementById("usage").value = "";
      document.getElementById("previousDue").value = 0;
    }

  });

}
</script>  
<script src="app.js"></script>

</body>
</html>
